<!DOCTYPE html>
<html lang="en">
<head>
    <title>Browse Algorithms</title>
    <link rel="stylesheet" href="spryntax.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <script src="spryntax_main.js"></script>
</head>
<body>
    <header>
        <div class="top">
            <nav> 
                <a href="/">Home</a>
                <a href="/level_select">Level Select</a>
                <a href="/favorites">Favorites</a>
                <a href="/stats">Stats</a>
                <a href="/leaderboard">Leaderboard</a>
                <a href="/report">Report</a>
                <a href="/settings" class="split">Settings</a>
                <a href="/signup" class="split">Sign up</a>
                <a href="/login" class="split">Log in</a>
            </nav>
        </div>
    </header>
    <h1 class="gradient-text" data-text="Level Select">Level Select</h1>

    <!-- Algorithm List -->
    <div class="gray-background">
        <div class="card-container">
            <% for (let level in level_tags) { %>
                <div class="custom-card">
                    <div class="card-header">
                        <h3><%= nonreadable_to_readable[level] %></h3> 
                        <% if (favorites && favorites.includes(level)) { %>
                          <button class="unfavorite-button" data-algorithm="<%= level %>">Delete</button>
                        <% } else { %>
                          <button class="favorite-button" data-algorithm="<%= level %>">Favorite</button>
                        <% } %>
                    </div>
                    <p><strong>Difficulty:</strong> <%= level_tags[level].difficulty %></p>
                    <p><strong>Type:</strong> <%= level_tags[level].type %></p>
                    <p>
                        <button type="button" onclick="location.href='level_select/<%- level %>/c';">C</button>
                        <button type="button" onclick="location.href='level_select/<%- level %>/py';">Python</button>
                    </p>
                </div>
            <% } %>
        </div>
    </div>
    <script>
      // For adding a favorite
      document.querySelectorAll('.favorite-button').forEach(button => {
        button.addEventListener('click', function() {
          const levelKey = this.getAttribute('data-algorithm');
          fetch('/favorites/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ algorithmName: levelKey })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert("Favorite added!");
              location.reload();
            } else {
              alert("Error: " + (data.message || data.error));
            }
          })
          .catch(err => console.error('Error:', err));
        });
      });

      // For removing a favorite
      document.querySelectorAll('.unfavorite-button').forEach(button => {
        button.addEventListener('click', function() {
          const levelKey = this.getAttribute('data-algorithm');
          fetch('/favorites/remove', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ algorithmName: levelKey })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert("Favorite removed!");
              location.reload();
            } else {
              alert("Error: " + (data.message || data.error));
            }
          })
          .catch(err => console.error('Error:', err));
        });
      });
    </script>
</body>
</html>
